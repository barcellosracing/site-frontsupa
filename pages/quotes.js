import { useEffect, useState } from 'react'
import { supabase } from '../lib/supabase'
import { isAdmin } from '../lib/admin'
export default function Quotes(){ const [quotes,setQuotes]=useState([]); const [clients,setClients]=useState([]); const [clientId,setClientId]=useState(''); const [items,setItems]=useState(''); const [total,setTotal]=useState('')
useEffect(()=>{ fetch() },[])
async function fetch(){ const { data } = await supabase.from('quotes').select('*,clients(*)').order('created_at',{ascending:false}); setQuotes(data||[]); const { data:clients } = await supabase.from('clients').select('*'); setClients(clients||[]) }
async function add(e){ e.preventDefault(); if(!isAdmin()){ alert('Apenas admin'); return } const created_at=new Date().toISOString(); await supabase.from('quotes').insert([{ client_id:clientId, items, total:parseFloat(total||0), created_at }]); setClientId(''); setItems(''); setTotal(''); fetch() }
return (<div><h2 className="text-2xl font-semibold mb-4">Orçamentos</h2>{isAdmin() && (<form onSubmit={add} className="mb-4 grid gap-2 sm:grid-cols-4"><select className="p-2 border rounded" value={clientId} onChange={e=>setClientId(e.target.value)}><option value=''>Selecione cliente</option>{clients.map(c=>(<option key={c.id} value={c.id}>{c.name}</option>))}</select><input className="p-2 border rounded" placeholder="Itens (descrição)" value={items} onChange={e=>setItems(e.target.value)} /><input className="p-2 border rounded" placeholder="Total" value={total} onChange={e=>setTotal(e.target.value)} /><button className="p-2 rounded btn">Salvar</button></form>)}<div className="grid gap-3">{quotes.map(q=>(<div key={q.id} className="card"><div className="font-medium">Cliente: {q.clients?.name}</div><div className="text-sm">Itens: {q.items}</div><div className="text-sm">Total: R$ {q.total}</div><div className="text-xs" style={{color:'var(--muted)'}}>Adicionado: {q.created_at ? new Date(q.created_at).toLocaleString() : ''}</div></div>))}</div></div>) }
